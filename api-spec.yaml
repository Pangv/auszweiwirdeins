openapi: 3.0.3
info:
  title: Hochzeits-RSVP API
  description: |
    API zur Verwaltung von Gästerückmeldungen für die Hochzeit am 30.07.2026.
    Diese Spezifikation kann mit Spring Boot oder Ktor implementiert werden.
  version: 1.0.0
  contact:
    name: Hochzeits-Team
    email: info@hochzeit.example

servers:
  - url: https://api.example.com/v1
    description: Produktions-Server
  - url: http://localhost:8080/v1
    description: Lokaler Entwicklungsserver

tags:
  - name: RSVP
    description: Endpoints für Gästerückmeldungen

paths:
  /wedding-rsvp:
    post:
      tags:
        - RSVP
      summary: Neue Gästerückmeldung anlegen
      description: |
        Nimmt eine neue Rückmeldung eines Gastes entgegen und speichert diese.
        Validiert die Eingaben und gibt eine Bestätigung zurück.
      operationId: createRSVP
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RSVPRequest'
            examples:
              attending:
                summary: Gast nimmt teil
                value:
                  name: "Max und Maria Mustermann"
                  attending: "yes"
                  guestCount: "2"
                  musicWishes: "Helene Fischer und Ed Sheeran"
                  dietaryRestrictions: "Maria ist Vegetarierin"
                  submittedAt: "2026-01-15T14:30:00Z"
              notAttending:
                summary: Gast nimmt nicht teil
                value:
                  name: "Peter Schmidt"
                  attending: "no"
                  guestCount: "1"
                  musicWishes: ""
                  dietaryRestrictions: ""
                  submittedAt: "2026-01-20T10:15:00Z"
      responses:
        '201':
          description: Rückmeldung erfolgreich gespeichert
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RSVPResponse'
              example:
                id: "550e8400-e29b-41d4-a716-446655440000"
                message: "Vielen Dank für eure Rückmeldung!"
                status: "success"
                submittedAt: "2026-01-15T14:30:00Z"
        '400':
          description: Ungültige Anfrage (Validierungsfehler)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                error: "Validation Error"
                message: "Das Feld 'name' ist erforderlich."
                timestamp: "2026-01-15T14:30:00Z"
        '500':
          description: Interner Serverfehler
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                error: "Internal Server Error"
                message: "Ein unerwarteter Fehler ist aufgetreten."
                timestamp: "2026-01-15T14:30:00Z"

    get:
      tags:
        - RSVP
      summary: Alle Gästerückmeldungen abrufen
      description: |
        Ruft alle gespeicherten Rückmeldungen ab.
        Erfordert Authentifizierung (nur für Hochzeitspaar/Admins).
      operationId: getAllRSVPs
      security:
        - bearerAuth: []
      parameters:
        - name: attending
          in: query
          description: Filtert nach Zusage-Status
          required: false
          schema:
            type: string
            enum: [yes, no]
        - name: page
          in: query
          description: Seitennummer für Pagination
          required: false
          schema:
            type: integer
            default: 0
        - name: size
          in: query
          description: Anzahl der Einträge pro Seite
          required: false
          schema:
            type: integer
            default: 20
            maximum: 100
      responses:
        '200':
          description: Liste aller Rückmeldungen
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RSVPListResponse'
        '401':
          description: Nicht authentifiziert
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: Keine Berechtigung
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /wedding-rsvp/{id}:
    get:
      tags:
        - RSVP
      summary: Einzelne Rückmeldung abrufen
      description: Ruft eine spezifische Rückmeldung anhand ihrer ID ab
      operationId: getRSVPById
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          description: UUID der Rückmeldung
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Rückmeldung gefunden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RSVPDetail'
        '404':
          description: Rückmeldung nicht gefunden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    put:
      tags:
        - RSVP
      summary: Rückmeldung aktualisieren
      description: Aktualisiert eine bestehende Rückmeldung
      operationId: updateRSVP
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          description: UUID der Rückmeldung
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RSVPRequest'
      responses:
        '200':
          description: Rückmeldung erfolgreich aktualisiert
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RSVPResponse'
        '404':
          description: Rückmeldung nicht gefunden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    delete:
      tags:
        - RSVP
      summary: Rückmeldung löschen
      description: Löscht eine Rückmeldung (nur für Admins)
      operationId: deleteRSVP
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          description: UUID der Rückmeldung
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '204':
          description: Erfolgreich gelöscht
        '404':
          description: Rückmeldung nicht gefunden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

components:
  schemas:
    RSVPRequest:
      type: object
      required:
        - name
        - attending
      properties:
        name:
          type: string
          description: Name des Gastes / der Gäste
          minLength: 2
          maxLength: 200
          example: "Max und Maria Mustermann"
        attending:
          type: string
          description: Zusage-Status
          enum: [yes, no]
          example: "yes"
        guestCount:
          type: string
          description: Anzahl der Personen
          pattern: '^\d+$'
          example: "2"
        musicWishes:
          type: string
          description: Musikwünsche für die Feier
          maxLength: 1000
          example: "Helene Fischer und Ed Sheeran"
        dietaryRestrictions:
          type: string
          description: Ernährungswünsche und Unverträglichkeiten
          maxLength: 1000
          example: "Maria ist Vegetarierin, Max hat eine Nussallergie"
        submittedAt:
          type: string
          format: date-time
          description: Zeitpunkt der Absendung (ISO 8601)
          example: "2026-01-15T14:30:00Z"

    RSVPResponse:
      type: object
      properties:
        id:
          type: string
          format: uuid
          description: Eindeutige ID der Rückmeldung
          example: "550e8400-e29b-41d4-a716-446655440000"
        message:
          type: string
          description: Bestätigungsnachricht
          example: "Vielen Dank für eure Rückmeldung!"
        status:
          type: string
          enum: [success, error]
          example: "success"
        submittedAt:
          type: string
          format: date-time
          example: "2026-01-15T14:30:00Z"

    RSVPDetail:
      allOf:
        - $ref: '#/components/schemas/RSVPRequest'
        - type: object
          properties:
            id:
              type: string
              format: uuid
              example: "550e8400-e29b-41d4-a716-446655440000"
            createdAt:
              type: string
              format: date-time
              example: "2026-01-15T14:30:00Z"
            updatedAt:
              type: string
              format: date-time
              example: "2026-01-15T14:30:00Z"

    RSVPListResponse:
      type: object
      properties:
        content:
          type: array
          items:
            $ref: '#/components/schemas/RSVPDetail'
        totalElements:
          type: integer
          description: Gesamtanzahl der Rückmeldungen
          example: 42
        totalPages:
          type: integer
          description: Gesamtanzahl der Seiten
          example: 3
        currentPage:
          type: integer
          description: Aktuelle Seite
          example: 0
        pageSize:
          type: integer
          description: Anzahl der Elemente pro Seite
          example: 20

    ErrorResponse:
      type: object
      required:
        - error
        - message
        - timestamp
      properties:
        error:
          type: string
          description: Fehlertyp
          example: "Validation Error"
        message:
          type: string
          description: Detaillierte Fehlerbeschreibung
          example: "Das Feld 'name' ist erforderlich."
        timestamp:
          type: string
          format: date-time
          description: Zeitpunkt des Fehlers
          example: "2026-01-15T14:30:00Z"
        details:
          type: object
          description: Zusätzliche Fehlerdetails (optional)
          additionalProperties:
            type: string

  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: |
        JWT Bearer Token für Admin-Endpoints.
        Format: Authorization: Bearer <token>
